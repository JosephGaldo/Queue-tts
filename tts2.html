<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Queue Voice Announcer</title>
</head>
<body>
  <h1>Now Serving: <span id="display"></span></h1>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const number = urlParams.get('number') || 'R#001';
    const counter = urlParams.get('counter') || '1';

    const messageText = `Now serving ${number} ${counter}`;
    document.getElementById("display").textContent = messageText;

    let selectedVoice = null;

    function findFemaleVoice() {
      const voices = speechSynthesis.getVoices();
      const femaleVoices = voices.filter(voice =>
        voice.name.toLowerCase().includes('female') ||
        voice.name.toLowerCase().includes('woman') ||
        voice.name.toLowerCase().includes('girl') ||
        voice.name.toLowerCase().includes('zira') ||    // Windows female
        voice.name.toLowerCase().includes('samantha') || // macOS/iOS
        voice.name.toLowerCase().includes('karen') ||
        voice.name.toLowerCase().includes('joanna')
      );
      if (femaleVoices.length > 0) {
        selectedVoice = femaleVoices[0];
      } else if (voices.length > 0) {
        selectedVoice = voices[0]; // fallback
      }
    }

    function speakAndClose() {
      if (!selectedVoice) findFemaleVoice();

      const silence = new SpeechSynthesisUtterance('');
      silence.volume = 0;
      silence.lang = 'en-US';

      const message = new SpeechSynthesisUtterance(`Now serving ${number}... ${counter}`);
      message.voice = selectedVoice;
      message.lang = 'en-US';

      message.onend = () => {
        setTimeout(() => window.close(), 500); // Close the tab 0.5s after speaking
      };

      speechSynthesis.speak(silence);
      speechSynthesis.speak(message);
    }

    window.onload = () => {
      if (speechSynthesis.getVoices().length > 0) {
        findFemaleVoice();
        speakAndClose();
      } else {
        speechSynthesis.onvoiceschanged = () => {
          findFemaleVoice();
          speakAndClose();
        };
      }
    };
  </script>
</body>
</html>